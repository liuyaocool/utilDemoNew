# 事物

DML: insert、update 和 delete语句

## 四个特性 ACID

1. 原子性 Atomicity

   - 一个原子事务要么完整执行,要么干脆不执行。这意味着,工作单元中的每项任务都必须正确执行。如果有任一任务执行失败,则整个工作单元或事务就会被终止。即此前对数据所作的任何修改都将被撤销。如果所有任务都被成功执行,事务就会被提交,即对数据所作的修改将会是永久性的

2. **一致性 Consistency 最关键** 

   - 一致性代表了底层数据存储的完整性。它必须由事务系统和应用开发人员共同来保证。事务系统通过保证事务的原子性,隔离性和持久性来满足这一要求；应用开发人员则需要保证数据库有适当的约束(主键,引用完整性等),并且工作单元中所实现的业务逻輯不会导致数据的不一致（即,数据预期所表达的现实业务情况不相一致）。
   - 例如，在一次转账过程中，从某一账户中扣除的金额必须与另一账户存入的金额相等。支付宝账号100你读到余额要取,有人向你转100但是事物没提交（这时候你读到的余额应该是100,而不是200）这种就是一致性

3. 隔离性 isolation

   - 隔离性意味着事务必须在不干扰其他进程或事务的前提下独立执行。换言之,在事务或工作单元执行完毕之前,其所访问的数据不能受系统其他部分的影响。

   - 隔离级别
     1. 读未提交 read uncommitted  脏读
     2. 读已提交 reaad commited
     3. 可重复读 repeatable read
     4. 序列化 Serializable

   - 数据不一致问题
     	1. 脏读
      	2. 不可重复读
      	3. 幻读

   - 严格隔离会导致效率降低

4. 持久性 Durability

   - 表示在某个事务的执行过程中,对数据所作的所有改动都必须在事务成功结束前保存至某种物理存储设备。这样可以保证,所作的修改在任何系统瘫痪时不至于丢失
   - 即 持久化到磁盘 或 存储介质中

# 锁

- 并发 数据不一致的问题 需要加锁
- 粒度
  1. 库
  2. 表
  3. 行
- 一般 粒度越小 效率越高
- 实际工作环境中，大部分操作都是行级锁